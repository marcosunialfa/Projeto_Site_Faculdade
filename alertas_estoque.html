<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Alertas de Estoque</title>
    <link rel="stylesheet" href="css/tabela_dados.css">
    <link rel="stylesheet" href="css/menu-lateral.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
  <nav class="meu-lateral">
    <div class="btn-expandir"><i class="bi bi-list"></i></div>
    <ul>
      <li class="item-meu"><a href="painel.html"><span class="icon"><i class="bi bi-house-door-fill"></i></span><span class="txt-link">Home</span></a></li>
      <li class="item-meu"><a href="alertas_estoque.html"><span class="icon"><i class="bi bi-chat-dots"></i></span><span class="txt-link">Alerta Estoque</span></a></li>
      <li class="item-meu"><a href="Formulario_dados.html"><span class="icon"><i class="bi bi-chat-dots"></i></span><span class="txt-link">Dados do Formulário</span></a></li>
      <li class="item-meu"><a href="dodos_loja.html"><span class="icon"><i class="bi bi-basket"></i></span><span class="txt-link">Dados da Loja</span></a></li>
      <li class="item-meu"><a href="estoque_produtos/index.html"><span class="icon"><i class="bi bi-cart-check"></i></span><span class="txt-link">Cadastra Produto</span></a></li>
      <li class="item-meu"><a href="estoque_produtos/atualizar_estoque.html"><span class="icon"><i class="bi bi-database-fill-check"></i></span><span class="txt-link">Atualizar Estoque</span></a></li>
      <li class="item-meu"><a href="estoque_produtos/verEstoque.html"><span class="icon"><i class="bi bi-boxes"></i></span><span class="txt-link">Estoque</span></a></li>
      <li class="item-meu"><a href="Login.html"><span class="icon"><i class="bi bi-power"></i></span><span class="txt-link">Sair</span></a></li>
    </ul>
  </nav>

    <div class="container">
        <h1>Alertas de Estoque</h1>
        <table class="summary-table">
            <thead>
                <tr>
                    <th>Cliente</th>
                    <th>Telefone</th>
                    <th>Produto</th>
                    <th>Qtd. Solicitada</th>
                    <th>Qtd. Disponível</th>
                    <th>Compra ID</th>
                    <th>Data</th>
                </tr>
            </thead>
            <tbody id="alertas-body">
                <!-- Dados inseridos via JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
    fetch('listar_alertas.php')
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById("alertas-body");

            if (data.success && data.alertas.length > 0) {
                data.alertas.forEach(alerta => {
                    const dataFormatada = alerta.data ? alerta.data : 'Data não informada';
                    const telefone = alerta.telefone ? alerta.telefone : 'Sem telefone';

                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${alerta.cliente}</td>
                        <td>${telefone}</td>
                        <td>${alerta.nome_produto} (${alerta.codigo_produto})</td>
                        <td>${alerta.quantidade_solicitada}</td>
                        <td>${alerta.quantidade_disponivel}</td>
                        <td>#${alerta.compra_id}</td>
                        <td>${dataFormatada}</td>
                    `;
                    tbody.appendChild(row);
                });
            } else {
                const row = document.createElement("tr");
                row.innerHTML = `<td colspan="7">Nenhum alerta encontrado.</td>`;
                tbody.appendChild(row);
            }
        })
        .catch(error => {
            console.error("Erro ao carregar alertas:", error);
            const tbody = document.getElementById("alertas-body");
            const row = document.createElement("tr");
            row.innerHTML = `<td colspan="7">Erro ao carregar os alertas.</td>`;
            tbody.appendChild(row);
        });

    </script>
</body>
</html>
